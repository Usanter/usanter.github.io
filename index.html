<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thomas Rolland — AI Research</title>
    <meta name="description" content="Minimal, elegant personal site with soft glass cards, subtle gradients, and gentle motion." />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..800&display=swap" rel="stylesheet">

    <style>
      :root {
        --bg: #f6f7f9;
        --surface: rgba(255,255,255,0.25);
        --text: #0e1116;
        --muted: #5a6472;
        --outline: rgba(255,255,255,0.4);
        --radius: clamp(16px, 2.2vw, 24px);
        --shadow: 0 1px 1px rgba(0,0,0,.05), 0 10px 30px rgba(12,20,33,.12);
      }
      body { margin:0; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); }

      .backdrop { position: fixed; inset: -20% -10% auto -10%; height: 60vh; z-index: -2;
        background: radial-gradient(42% 60% at 20% 30%, hsla(218,86%,55%,.18), transparent 55%),
                    radial-gradient(40% 55% at 78% 25%, hsla(266,85%,62%,.16), transparent 60%),
                    radial-gradient(70% 70% at 50% 90%, hsla(194,86%,54%,.14), transparent 60%);
        filter: blur(40px) saturate(120%);
        animation: floatY 18s ease-in-out infinite alternate; }
      @keyframes floatY { from { transform: translateY(-2%);} to { transform: translateY(4%);} }

      #liquid-bg { position: fixed; inset: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; display: block; }

      .container { max-width: 1040px; margin: 0 auto; padding: 32px 20px 64px; }
      header.site-header { position:sticky; top:0; z-index:1000;
        display:flex; align-items:center; justify-content:space-between; gap:16px; padding:10px 14px;
        /* Glass style to match cards */
        background: var(--surface);
        border: 1px solid var(--outline);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
        box-shadow: 0 8px 24px rgba(0,0,0,.12);
        border-radius: 0 0 var(--radius) var(--radius);
      }
      .brand { font-weight:700; letter-spacing:-0.02em; font-size:clamp(18px,1.4vw,22px); opacity:.9; text-decoration:none; color:inherit; }
      nav a { color:var(--muted); text-decoration:none; margin-left:18px; font-size:14px; padding:10px 12px; border-radius:12px; }
      nav a:hover { background: rgba(255,255,255,0.5); color:var(--text); }

      .card { position: relative; border-radius: var(--radius); overflow: clip;
        background: var(--surface); border: 1px solid var(--outline);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
        box-shadow: 0 8px 24px rgba(0,0,0,.12); }

      .hero { display:grid; grid-template-columns: 1.15fr .85fr; gap:clamp(16px,3vw,24px); align-items:stretch; }
      @media(max-width:860px){.hero{grid-template-columns:1fr;}}
      .hero-card { padding: clamp(22px,4.2vw,36px); }
      .hero h1 { margin:0 0 8px; font-size:clamp(28px,5vw,52px); letter-spacing:-0.03em; }
      .hero p.lead { margin:0 0 20px; color:var(--muted); font-size:clamp(16px,1.6vw,18px); }

      .cta { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
      .btn { position:relative; display:inline-flex; align-items:center; gap:10px; border:1px solid var(--outline); background:rgba(255,255,255,0.4);
        padding:12px 16px; border-radius:14px; color:var(--text); text-decoration:none; font-weight:600; box-shadow:var(--shadow); }
      .btn:hover { transform:translateY(-1px); }
      .btn.primary { border:none; background:linear-gradient(135deg, hsl(218,86%,55%), hsl(194,86%,54%)); color:white; }

      .media-card { display:grid; place-items:center; padding: clamp(14px,2vw,18px); }
      .portrait { width:100%; aspect-ratio:4/5; object-fit:cover; border-radius:calc(var(--radius) - 6px);
        box-shadow: 0 0 30px rgba(0,0,0,.15), inset 0 0 0 1px var(--outline), 0 0 40px hsl(218,86%,55%,.25); }

      section { margin-top:clamp(28px,6vw,72px); }
      .section-title { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
      .section-title h2 { margin:0; font-size:clamp(18px,2.4vw,22px); letter-spacing:-0.01em; opacity:.9; }
      .section-title p { margin:0; color:var(--muted); font-size:14px; }

      /* About/Publication blocks: unify look with hero */
      .about.card, .pub-intro.card { padding:clamp(22px,4vw,32px); }
      .about p, .pub-intro p { margin:0 0 12px; color:var(--muted); }
      .list-clean { margin: 8px 0 0; padding-left: 0; list-style: none; color: var(--muted); }
      .list-clean li { margin: 6px 0; display: flex; gap:10px; align-items: flex-start; }
      .list-clean li .b { width: 1.1em; text-align: center; opacity: .7; }
      .cta-row { display:flex; flex-wrap:wrap; gap:10px; margin-top: 14px; }

      footer { color:var(--muted); font-size:13px; padding:28px 4px 0; text-align:center; }
      .gradient-text { background:linear-gradient(135deg,hsl(218,86%,55%),hsl(194,86%,54%) 50%,hsl(266,85%,62%) 100%);
        -webkit-background-clip:text; background-clip:text; color:transparent; }
          /* Simple responsive 3-column grid for boxes */
      .grid-3 { display:grid; gap:clamp(12px,2.4vw,20px); grid-template-columns:repeat(3,1fr); }
      @media (max-width: 980px){ .grid-3 { grid-template-columns: repeat(2,1fr); } }
      @media (max-width: 640px){ .grid-3 { grid-template-columns: 1fr; } }
      .project.card { padding:18px; display:flex; flex-direction:column; min-height:160px; }
      .project h3 { margin:6px 0 6px; font-size:16px; }
      .project p { margin:0 0 10px; color:var(--muted); font-size:14px; }
      .pill { display:inline-block; border-radius:999px; padding:6px 10px; font-size:12px; border:1px solid var(--outline); color:var(--muted); }
      .topline { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .tags { display:flex; gap:8px; flex-wrap:wrap; margin-top:auto; }
      .tag { font-size:12px; padding:6px 8px; border:1px dashed var(--outline); border-radius:10px; color:var(--muted); }
      .actions { display:flex; gap:8px; margin-top:12px; }

      /* Blog post view (glass card with readable typography) */
      [hidden] { display: none !important; }
      .post.card { padding: clamp(18px,3.6vw,28px); max-width: 860px; margin: 0 auto; }
      .post .post-title { margin: 6px 0 12px; font-size: clamp(22px,3.6vw,32px); letter-spacing:-0.01em; }
      .prose { line-height: 1.7; color: var(--muted); font-size: 16px; }
      .prose h1, .prose h2, .prose h3, .prose h4 { color: var(--text); margin: 22px 0 10px; line-height:1.25; }
      .prose h1 { font-size: clamp(24px,4vw,34px); }
      .prose h2 { font-size: clamp(20px,3vw,28px); }
      .prose h3 { font-size: clamp(18px,2.4vw,22px); }
      .prose p { margin: 10px 0; }
      .prose ul, .prose ol { margin: 10px 0 10px 1.25em; }
      .prose li { margin: 6px 0; }
      .prose a { color: hsl(218,86%,45%); text-underline-offset: 2px; }
      .prose blockquote { margin: 12px 0; padding: 10px 12px; border-left: 3px solid hsl(218,86%,55%); background: rgba(255,255,255,0.4); border-radius: 10px; }
      .prose code { background: rgba(0,0,0,0.06); padding: 2px 6px; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color: #2a2f3a; }
      .prose pre { background: rgba(255,255,255,0.5); border: 1px solid var(--outline); border-radius: 12px; padding: 12px; overflow:auto; box-shadow: var(--shadow); }
      .prose pre code { background: transparent; padding: 0; }
    </style>
  </head>
  <body>
    <div class="backdrop" aria-hidden="true"></div>
    <canvas id="liquid-bg" aria-hidden="true"></canvas>

    <div class="container">
      <header class="site-header">
        <a class="brand" href="index.html">Thomas Rolland</a>
        <nav aria-label="Primary">
          <a href="#about">About</a>
          <a href="publications.html">Publications</a>
          <a href="activities.html">Activities</a>
          <a href="teaching.html">Teaching</a>
          <a href="posts.html">Blog</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <section class="hero">
        <div class="card hero-card">
          <h1>Dr. <span class="gradient-text">Thomas Rolland</span>, AI Research scientist.</h1>
          <p class="lead">My research focuses on advancing Automatic Speech Recognition (ASR) through the design of parameter-efficient architectures, large-scale synthetic data augmentation, and post-training strategies aimed at improving robustness, adaptability, and fairness across diverse languages, speakers, and domains.</p>
          <div class="cta">
            <a class="btn primary" href="https://github.com/Usanter" target="_blank" rel="noopener">View my GitHub</a>
            <a class="btn" href="mailto:trolland@protonmail.ch">Email me</a>
            <a class="btn" href="/Industry_CV.pdf" target="_blank" rel="noopener">CV (PDF)</a>
          </div>
        </div>
        <div class="card media-card" aria-label="Portrait">
          <img class="portrait" src="c92635ad-72ed-4561-97eb-76bd6b922681.jpg" alt="Portrait of Thomas Rolland" />
        </div>
      </section>

      <section id="about">
        <div class="section-title">
          <h2>About</h2>
          <p>Who I am</p>
        </div>
        <article class="card about">
          <p>I am a Postdoctoral Researcher at INESC‑ID (Lisbon) working on parameter‑efficient Transformers and speech technologies. I focus on ASR/TTS, synthetic data augmentation, and post‑training strategies for robustness and fairness.</p>
          <ul class="list-clean">
            <li><span class="b">🗣️</span><span>Children & low‑resource ASR with scalable TTS generation + filtering.</span></li>
            <li><span class="b">🧩</span><span>Parameter‑efficient learning: adapters, LoRA, shared-weights.</span></li>
            <li><span class="b">📈</span><span>Evaluation, reproducibility and privacy.</span></li>
          </ul>
          <div class="cta-row">
            <a class="btn" href="activities.html">Activities</a>
            <a class="btn" href="publications.html">Publications</a>
            <a class="btn" href="teaching.html">Teaching</a>
          </div>
        </article>
      </section>

      <section id="publications">
        <div class="section-title">
          <h2>Publications</h2>
          <p>Selected work</p>
        </div>
        <div class="card pub-intro">
          <p>Peer‑reviewed and preprint work across ASR, PEFT, and evaluation. Below are highlights — see the dedicated page for the full list and resources.</p>
          <div class="cta-row"><a class="btn" href="publications.html">View all publications</a></div>
        </div>
      </section>


      <section id="projects">
        <div class="section-title">
          <h2>Research Interests</h2>
          <p>Topics I'm interested in </p>
        </div>
        <div class="grid-3">
          <article class="project card">
            <div class="topline"><span class="pill">Speech processing</span><span class="pill">★</span></div>
            <h3>Automatic Speech Recognition</h3>
            <p>Children and Low-ressource ASR. Building large-scale TTS and filtering pipelines to expand training corpora and improve robustness.</p>
            <div class="tags"><span class="tag">ASR</span><span class="tag">Synthetic data generation & filtering pipeline</span></div>
          </article>
          <article class="project card">
            <div class="topline"><span class="pill"> NLP & Speech Processing</span><span class="pill">★</span></div>
            <h3>Multimodal & Responsible AI</h3>
            <p>Integrating acoustic and linguistic features for pathology detection and ensuring that speech technologies are interpretable, inclusive, and privacy-preserving.</p>
            <div class="tags"><span class="tag">Multimodal</span><span class="tag">Privacy</span></div>
          </article>
          <article class="project card">
            <div class="topline"><span class="pill">NLP & Speech processing</span><span class="pill">★</span></div>
            <h3>Post-training strategies</h3>
            <p>Exploring transfer learning, fine-tuning, and domain adaptation methods to enhance the adaptability and robustness of ASR and large language models (LLMs).</p>
            <div class="tags"><span class="tag">PEFT</span><span class="tag">RLHF</span></div>
          </article>
        </div>
      </section>

      <section id="projects">
        <div class="section-title">
          <h2>Projects</h2>
          <p>Past and present work</p>
        </div>
        <div class="grid-3">
          <article class="project card">
            <div class="topline"><span class="pill">Speech processing</span><span class="pill"></span></div>
            <h3>European Portuguese ASR</h3>
            <p>Development of state-of-the-art ASR systems for European Portuguese, as well as CAMÕES a comprehensive benchmark for ASR evaluation.</p>
            <div class="tags"><span class="tag">ASR</span></div>
            <div class="actions"><a class="btn" href="#">ASR Arena</a><a class="btn" href="#">Best model HF</a></div>

          </article>
          <article class="project card">
            <div class="topline"><span class="pill"> Speech Processing</span><span class="pill"></span></div>
            <h3>Children's speech data in the wild</h3>
            <p>Collecting children's speech from the wild. This project aims to create a diverse dataset that reflects real-world scenarios for testing purposes.</p>
            <div class="tags"><span class="tag">Data collection</span><span class="tag"></span></div>
            <div class="actions"><a class="btn" href="#">Dataset</a></div>

          </article>
          <article class="project card">
            <div class="topline"><span class="pill">NLP & Speech processing</span><span class="pill">★</span></div>
            <h3>Post-training strategies</h3>
            <p>Exploring transfer learning, fine-tuning, and domain adaptation methods to enhance the adaptability and robustness of ASR and large language models (LLMs).</p>
            <div class="tags"><span class="tag">PEFT</span><span class="tag">RLHF</span></div>
          </article>
        </div>
      </section>


      <section id="blog">
        <div class="section-title">
          <h2>Blog</h2>
          <p>Explainers & deep dives</p>
        </div>
        <div class="cta-row"><a class="btn" href="posts.html">View all posts</a></div>
        <div class="grid-3">
          {% assign recent = site.posts | slice: 0, 2 %}
          {% for post in recent %}
          <article class="project card">
            <div class="topline"><span class="pill">{{ post.date | date: "%Y-%m-%d" }}</span><span class="pill">Blog</span></div>
            <h3><a href="{{ post.url }}" style="text-decoration:none; color:inherit;">{{ post.title }}</a></h3>
            {% if post.summary %}<p>{{ post.summary }}</p>{% else %}<p>{{ post.excerpt | strip_html | truncate: 140 }}</p>{% endif %}
            {% if post.tags %}
              <div class="tags">{% for t in post.tags %}<span class="tag">{{ t }}</span>{% endfor %}</div>
            {% endif %}
            <div class="actions"><a class="btn" href="{{ post.url }}">Read</a></div>
          </article>
          {% endfor %}
        </div>
      </section>

      <section id="contact">
        <div class="section-title">
          <h2>Contact</h2>
          <p>Let’s collaborate</p>
        </div>
        <div class="card about">
          <p>Email: <a href="mailto:trolland@protonmail.ch">trolland@protonmail.ch</a> · <a href="https://github.com/Usanter" target="_blank" rel="noopener">GitHub</a> · <a href="https://linkedin.com/in/usanter" target="_blank" rel="noopener">LinkedIn</a> · <a href="/Industry_CV.pdf" target="_blank" rel="noopener">CV (PDF)</a></p>
        </div>
      </section>

      <footer>
        <small>© <span id="year"></span> Thomas Rolland. Built with semantic HTML.</small>
      </footer>
    </div>

    <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

<!-- Three.js pastel liquid background -->
<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

  const CONFIG = {
    colors: ['#FFFFFF', '#FEFCFB', '#F0F4FF', '#F3E8FF', '#FEF9F6'], // white, cream, soft blue, lavender, off‑white
    speed: 0.08,
    blur: 2.6,
    grain: 0.008,
    dprMax: 2.0
  };

  const canvas = document.getElementById('liquid-bg');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, powerPreference: 'high-performance' });
  const DPR = Math.min(window.devicePixelRatio || 1, CONFIG.dprMax);
  renderer.setPixelRatio(DPR);
  renderer.setClearColor(0xffffff, 1);

  const scene = new THREE.Scene();
  const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);

  const vertexShader = `
    varying vec2 vUv;
    void main(){ vUv = uv; gl_Position = vec4(position, 1.0); }
  `;

  const fragmentShader = `
    precision highp float;
    uniform float uTime; uniform vec2 uResolution; uniform vec3 uColors[5];
    uniform float uBlur; uniform float uGrain; uniform float uSpeed;
    float hash(vec2 p){ return fract(sin(dot(p, vec2(127.1,311.7)))*43758.5453123);} 
    float noise(vec2 p){ vec2 i=floor(p), f=fract(p);
      float a=hash(i), b=hash(i+vec2(1.,0.)), c=hash(i+vec2(0.,1.)), d=hash(i+vec2(1.,1.));
      vec2 u=f*f*(3.-2.*f); return mix(a,b,u.x)+(c-a)*u.y*(1.-u.x)+(d-b)*u.x*u.y; }
    float fbm(vec2 p){ float v=0., a=.5; for(int i=0;i<5;i++){ v+=a*noise(p); p=p*2.+vec2(10.5); a*=.5;} return v; }
    float metaball(vec2 p, vec2 c, float r){ float d=length(p-c); return r*r/(d*d+1e-3);} 
    vec3 multiMix(float t, vec3[5] cols){
      if(t<.25) return mix(cols[0],cols[1],smoothstep(0.,.25,t));
      else if(t<.5) return mix(cols[1],cols[2],smoothstep(.25,.5,t));
      else if(t<.75) return mix(cols[2],cols[3],smoothstep(.5,.75,t));
      else return mix(cols[3],cols[4],smoothstep(.75,1.,t));
    }
    void main(){
      vec2 uv = gl_FragCoord.xy / uResolution;
      vec2 p = (uv - 0.5) * 2.0; p.x *= uResolution.x / uResolution.y;
      float t = uTime * uSpeed;
      vec2 warp = vec2(fbm(p*1.2 + t*.30), fbm(vec2(p.y,p.x)*1.5 - t*.25));
      p += .25 * (warp - .5);
      vec2 c1=.70*vec2(sin(t*.70+0.), cos(t*.60+1.2));
      vec2 c2=.80*vec2(cos(t*.55+2.2), sin(t*.50+.3));
      vec2 c3=.90*vec2(sin(t*.40+4.), sin(t*.65+2.));
      vec2 c4=.60*vec2(cos(t*.33-1.), cos(t*.47-2.4));
      vec2 c5=.75*vec2(sin(t*.29-.5), cos(t*.41+.7));
      float field=0.;
      field+=metaball(p,c1,.65); field+=metaball(p,c2,.70); field+=metaball(p,c3,.60);
      field+=metaball(p,c4,.68); field+=metaball(p,c5,.62); field*=.22;
      float m=smoothstep(.35,.75,field);
      float r=uBlur/uResolution.y; vec2 off[8];
      off[0]=vec2( r,0.); off[1]=vec2(-r,0.); off[2]=vec2(0., r); off[3]=vec2(0.,-r);
      off[4]=vec2( r, r); off[5]=vec2(-r, r); off[6]=vec2( r,-r); off[7]=vec2(-r,-r);
      float accum=m;
      for(int i=0;i<8;i++){
        vec2 pp=p+off[i]; float f2=0.;
        f2+=metaball(pp,c1,.65); f2+=metaball(pp,c2,.70); f2+=metaball(pp,c3,.60);
        f2+=metaball(pp,c4,.68); f2+=metaball(pp,c5,.62); f2*=.22;
        accum+=smoothstep(.35,.75,f2);
      }
      float blurred=accum/9.;
      float n=fbm(p*1.8 + t*.15);
      float mixv=clamp(blurred + (n-.5)*.25, 0., 1.);
      vec3 col=multiMix(mixv, uColors);
      float vignette=smoothstep(1.4,.2,length(p));
      col*=mix(.99,1.03,vignette);
      float g=(hash(uv+fract(t))-.5)*uGrain; col+=g;
      gl_FragColor=vec4(col,1.);
    }
  `;

  const material = new THREE.ShaderMaterial({
    uniforms: {
      uTime: { value: 0 },
      uResolution: { value: new THREE.Vector2(1,1) },
      uColors: { value: CONFIG.colors.map(c => new THREE.Color(c)) },
      uBlur: { value: CONFIG.blur },
      uGrain: { value: CONFIG.grain },
      uSpeed: { value: CONFIG.speed },
    },
    vertexShader: vertexShader,
    fragmentShader: fragmentShader,
    depthTest: false,
    depthWrite: false,
  });

  const quad = new THREE.Mesh(new THREE.PlaneGeometry(2,2), material);
  scene.add(quad);

  function resize(){
    const w = window.innerWidth, h = window.innerHeight;
    renderer.setSize(w, h, false);
    material.uniforms.uResolution.value.set(w * DPR, h * DPR);
  }
  window.addEventListener('resize', resize, { passive: true });
  resize();

  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function updateSpeed(){ material.uniforms.uSpeed.value = media.matches ? CONFIG.speed * 0.08 : CONFIG.speed; }
  media.addEventListener?.('change', updateSpeed);
  updateSpeed();

  const clock = new THREE.Clock();
  function tick(){
    material.uniforms.uTime.value = clock.getElapsedTime();
    renderer.render(scene, camera);
    requestAnimationFrame(tick);
  }
  tick();

  document.addEventListener('visibilitychange', ()=>{ if (document.hidden) clock.stop(); else clock.start(); });
</script>
  
  <!-- Simple client-side blog list from Markdown files -->
  <script>
    (async function(){
      let posts = [ { path: 'blog-soft-liquid-gradient.md' } ];
      // Try loading a manifest if present
      try {
        const res = await fetch('posts/posts.json', { cache: 'no-store' });
        if (res.ok) {
          const list = await res.json();
          posts = list
            .map(p => ({ path: p.path, title: p.title, date: p.date, summary: p.summary, tags: Array.isArray(p.tags)? p.tags.join(', '): p.tags }))
            .sort((a,b) => String(b.date||'').localeCompare(String(a.date||'')))
            .slice(0, 2); // show a couple on the homepage
        }
      } catch (_) { /* ignore; fallback to default */ }
      const el = document.getElementById('blog-list');
      if(!el) return;

      function parseFrontmatter(text){
        let meta = {}; let body = text;
        if (text.startsWith('---')){
          const end = text.indexOf('\n---', 3);
          if (end !== -1){
            const block = text.slice(3, end).trim();
            body = text.slice(end + 4).trim();
            for (const line of block.split('\n')){
              const idx = line.indexOf(':');
              if (idx > -1){
                const k = line.slice(0, idx).trim();
                const v = line.slice(idx + 1).trim();
                meta[k] = v.replace(/^"|"$/g, '');
              }
            }
          }
        }
        if (!meta.title){
          const m = body.match(/^#\s+(.+)$/m);
          if (m) meta.title = m[1].trim();
        }
        if (!meta.summary){
          const paras = body.split(/\n\s*\n/).map(s => s.trim()).filter(Boolean);
          const firstPara = paras.find(p => !p.startsWith('#'));
          if (firstPara) meta.summary = firstPara.replace(/^>\s*/,'');
        }
        return { meta, body };
      }

      function renderCard({ title, date, summary, path, tags }){
        const article = document.createElement('article');
        article.className = 'project card';
        const tagsHtml = (tags||'').split(',').map(t => t.trim()).filter(Boolean).map(t => `<span class="tag">${t}</span>`).join('');
        article.innerHTML = `
          <div class="topline"><span class="pill">${date || ''}</span><span class="pill">Blog</span></div>
          <h3>${title || path}</h3>
          <p>${summary || ''}</p>
          ${tagsHtml ? `<div class=\"tags\">${tagsHtml}</div>` : ''}
          <div class="actions"><button class="btn read-post" data-path="${path}">Read</button><a class="btn" href="${path}" target="_blank" rel="noopener">Raw (.md)</a></div>
        `;
        return article;
      }

      async function load(){
        for (const p of posts){
          try {
            const res = await fetch(p.path);
            if (!res.ok) throw new Error('HTTP '+res.status);
            const text = await res.text();
            const { meta } = parseFrontmatter(text);
            const card = renderCard({
              title: meta.title,
              date: meta.date,
              summary: meta.summary,
              tags: meta.tags,
              path: p.path,
            });
            el.appendChild(card);
          } catch (err){
            const fallback = renderCard({ title: p.path, summary: 'Could not load post.', path: p.path });
            el.appendChild(fallback);
          }
        }
      }
      load();
    })();
  </script>
  
  <!-- Blog reader: transform list links into in-page glass post view -->
  <script>
    (function(){
      const listEl = document.getElementById('blog-list');
      const viewEl = document.getElementById('post-view');
      const titleEl = document.getElementById('post-title');
      const dateEl = document.getElementById('post-date');
      const tagsEl = document.getElementById('post-tags');
      const contentEl = document.getElementById('post-content');
      const backBtn = document.getElementById('post-back');
      const rawLink = document.getElementById('post-raw');
      if(!listEl || !viewEl) return;

      function escapeHtml(s){ return s.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }
      function parseFrontmatter(text){
        let meta = {}; let body = text;
        if (text.startsWith('---')){
          const end = text.indexOf('\n---', 3);
          if (end !== -1){
            const block = text.slice(3, end).trim();
            body = text.slice(end + 4).trim();
            for (const line of block.split('\n')){
              const idx = line.indexOf(':');
              if (idx > -1){ const k = line.slice(0, idx).trim(); const v = line.slice(idx + 1).trim(); meta[k] = v.replace(/^\"|\"$/g, ''); }
            }
          }
        }
        if (!meta.title){ const m = body.match(/^#\s+(.+)$/m); if (m) meta.title = m[1].trim(); }
        if (!meta.summary){ const paras = body.split(/\n\s*\n/).map(s => s.trim()).filter(Boolean); const firstPara = paras.find(p => !p.startsWith('#')); if (firstPara) meta.summary = firstPara.replace(/^>\s*/,''); }
        return { meta, body };
      }
      function mdToHtml(md){
        const fenceRegex = /```([\w-]*)\n([\s\S]*?)```/g; const fences = [];
        md = md.replace(fenceRegex, (_, lang, code) => { const i = fences.push({ lang, code }) - 1; return `§§FENCE${i}§§`; });
        const lines = md.split(/\r?\n/); const out = []; let inOl = false, inUl = false;
        const closeLists = () => { if(inOl){ out.push('</ol>'); inOl=false; } if(inUl){ out.push('</ul>'); inUl=false; } };
        for (let raw of lines){ let line = raw.trimEnd(); if (!line){ closeLists(); out.push(''); continue; }
          const h = line.match(/^(#{1,6})\s+(.*)$/); if (h){ closeLists(); const lvl=h[1].length; out.push(`<h${lvl}>${escapeHtml(h[2])}</h${lvl}>`); continue; }
          const ol = line.match(/^\d+\.\s+(.*)$/); if (ol){ if(!inOl){ closeLists(); out.push('<ol>'); inOl=true; } out.push(`<li>${escapeHtml(ol[1])}</li>`); continue; }
          const ul = line.match(/^[-*]\s+(.*)$/); if (ul){ if(!inUl){ closeLists(); out.push('<ul>'); inUl=true; } out.push(`<li>${escapeHtml(ul[1])}</li>`); continue; }
          const bq = line.match(/^>\s?(.*)$/); if (bq){ closeLists(); out.push(`<blockquote><p>${escapeHtml(bq[1])}</p></blockquote>`); continue; }
          closeLists(); out.push(`<p>${escapeHtml(line)}</p>`); }
        let html = out.join('\n');
        html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                   .replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<em>$1</em>')
                   .replace(/`([^`]+)`/g, '<code>$1</code>')
                   .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
        html = html.replace(/§§FENCE(\d+)§§/g, (_, i) => { const f = fences[Number(i)]; return `<pre><code class="language-${escapeHtml(f.lang||'')}">${escapeHtml(f.code)}</code></pre>`; });
        return html;
      }

      async function showPost(path){
        try{
          const res = await fetch(path); if (!res.ok) throw new Error('HTTP '+res.status);
          const text = await res.text();
          const { meta, body } = parseFrontmatter(text);
          titleEl.textContent = meta.title || path; dateEl.textContent = meta.date || '';
          tagsEl.innerHTML = (meta.tags||'').split(',').map(t => t.trim()).filter(Boolean).map(t => `<span class="tag">${t}</span>`).join('');
          contentEl.innerHTML = mdToHtml(body); rawLink.href = path;
          listEl.hidden = true; viewEl.hidden = false;
          if (!location.hash.startsWith('#post=')) history.pushState({ post: path }, '', `#post=${encodeURIComponent(path)}`);
          viewEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } catch(err){ window.open(path, '_blank'); }
      }
      function hidePost(){ viewEl.hidden = true; listEl.hidden = false; }

      // Cards already include a Read button created by the first script

      listEl.addEventListener('click', (e) => {
        const btn = e.target.closest('.read-post'); if (btn){ e.preventDefault(); showPost(btn.dataset.path); }
      }, true);
      backBtn?.addEventListener('click', () => { hidePost(); history.pushState({}, '', '#blog'); });
      window.addEventListener('hashchange', () => { const m = location.hash.match(/#post=([^&]+)/); if (m) showPost(decodeURIComponent(m[1])); else hidePost(); });
      // deep link on load
      const m = location.hash.match(/#post=([^&]+)/); if (m) showPost(decodeURIComponent(m[1]));
    })();
  </script>
  </body>
</html>
